@using Newtonsoft.Json;
@model AddSetViewModel

@{

    ViewData["Title"] = "Add Set";
    Layout = "~/Views/Shared/_LayoutPublic.cshtml";

    List<SelectListItem> tokGroupListPre = new List<SelectListItem>();
    List<SelectListItem> tokGroupList = new List<SelectListItem>();
    List<SelectListItem> tokTypeList = new List<SelectListItem>();
    tokTypeList.Add(new SelectListItem
    {
        Text = "Choose...",
        Value = "Choose",
        Selected = true
    });

    if (Model.TokGroups != null)
    {
        for (int i = 0; i < Model.TokGroups?.Count(); ++i)   //Can also be ViewBag.Category
        {
            tokGroupListPre.Add(new SelectListItem
            {
                Text = Model.TokGroups[i].TokGroup,
                Value = JsonConvert.SerializeObject(Model.TokGroups[i]),
                Selected = false
            });


        }
        tokGroupListPre = tokGroupListPre.OrderBy(x => x.Text).ToList<SelectListItem>();

        tokGroupList.Add(new SelectListItem
        {
            Text = "Choose...",
            Value = "Choose",
            Selected = true
        });

        foreach (var item in tokGroupListPre) { tokGroupList.Add(item); }
    }
}

@section Styles {
    <link type="text/css" rel="stylesheet" href="~/css/croppie.css" />
}

<!-- **** BACKGROUND !Important **** -->
<section class="tokkepedia-main clearfix">
    <div class="tokkepdia-sub">
    </div>
</section>
<!-- **** /BACKGROUND **** -->

<section class="special-area bg-white">
    <div class="container h-100">
        <div class="row h-100">
            <div class="col-12 col-md header-spacing">

                <div class="container bg-light">
                    <div class="py-5 text-center" style="padding-bottom:0.3rem!important;">
                        <h2>Add Set</h2>
                        <p class="lead">Sets hold toks so they can be used for games</p>
                        @*<a class="nav-link" asp-area="" asp-controller="Home" asp-action="addmultipletoks">Click here to add multiple toks at once:</a>*@
                    </div>

                    <br />

                    <div class="row">

                        <div class="col-md-12 order-md-1">
                            <h4 class="mb-3">Enter the Set info</h4>

                            <form id="frmAddSet" asp-controller="Set" asp-action="AddSet" asp-route-returnurl="@ViewData["ReturnUrl"]" method="post" class="needs-validation" enctype="multipart/form-data" novalidate>
                                @Html.AntiForgeryToken()
                                <input type="hidden" asp-for="Set.TokGroup" id="TokGroup" />
                                <input type="hidden" asp-for="Set.TokType" id="TokType" />
                                <input type="hidden" asp-for="TokGroupDataString" id="TokGroupDataString" />
                                @Html.HiddenFor(x => x.Base64Image)
                                @Html.Hidden("GetSubtypes")

                                @*Section 1 - Categorical*@
                                <div class="row">

                                    <div class="col-md-6 mb-3">
                                        <label for="country">Tok Group</label>
                                        @Html.DropDownList("SelectGroup", tokGroupList, null, new { @class = "custom-select d-block w-100", id = "SelectGroup" })
                                        <div class="invalid-feedback">
                                            Please select a Tok Group.
                                        </div>

                                        <ul class="list-group mb-3">
                                            <li class="list-group-item d-flex justify-content-between lh-condensed">
                                                <div class="w-100">
                                                    <div class="speech-bubble center">
                                                        <small id="TokGroupDesc" style="color:white!important;">Please select a Tok Group</small>
                                                    </div>
                                                </div>
                                                <img id="TokGroupTokstar" src="~/images/tokstargirl1.jpg" alt="" class="mr-2 rounded-circle"
                                                     style="max-height:60px!important; max-width:60px!important; margin-left:0.5em!important; margin-right:0!important;">
                                            </li>
                                        </ul>


                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label for="country">Tok Type</label>
                                        @Html.DropDownList("SelectType", tokTypeList, null, new { @class = "custom-select d-block w-100", id = "SelectType" })
                                        <div class="invalid-feedback">
                                            Please select a Tok Type.
                                        </div>

                                        <ul class="list-group mb-3">
                                            <li class="list-group-item d-flex justify-content-between lh-condensed">
                                                <div>
                                                    @*<h6 id="TokTypeName" class="my-0">Tok Type</h6>*@
                                                    <small id="TokTypeDesc" class="text-muted"></small>
                                                    <br /><br />
                                                    <small id="TokTypeExam" class="text-muted" style="line-height:0.75!important; font-size:65%!important;">---</small>
                                                </div>
                                                <small class="text-muted" style="cursor:pointer;"><u><a id="BtnExam">Example</a></u></small>
                                            </li>
                                        </ul>

                                    </div>
                                </div>

                                @*Section 2 - Fields*@

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label id="PrivacyLabel">Privacy</label>
                                            <select asp-for="Set.Privacy" class="form-control" id="txtPrivacy">
                                                <option value="public" selected>Public</option>
                                                <option value="private">Private</option>
                                            </select>
                                            <h6 id="lblPrivacyNum"></h6>
                                            <div class="invalid-feedback">
                                                Please enter a valid value.
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label id="NameLabel">Name</label>
                                            <input asp-for="Set.Name" type="text" class="form-control" id="txtName" placeholder="" value="" required>
                                            <h6 id="lblNameNum"></h6>
                                            <div class="invalid-feedback">
                                                Please enter a valid value.
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">

                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label id="NameLabel">Description</label>
                                            <textarea asp-for="Set.Description" rows="3" class="form-control" id="txtDescription" placeholder="" value="" required></textarea>
                                            <h6 id="lblDescriptionNum"></h6>
                                            <div class="invalid-feedback">
                                                Please enter a valid value.
                                            </div>
                                        </div>
                                    </div>

                                </div>

                                <p class="lead">Select a PNG or JPEG icon, max size <span id="max-size">500</span> KB (optional)</p>
                                <div id="image-preview-div" style="display: none">
                                    <label for="exampleInputFile">Selected image:</label>
                                    <br>
                                    <div id="resizer">

                                    </div>
                                    @*<img id="preview-img" src="noimage">*@
                                </div>
                                <br />
                                <div class="col-md-3 mb-3">
                                    <label class="btn btn-block btn-primary">
                                        Browse&hellip; <input type="file" name="pic" id="pic" style="display: none;">
                                    </label>
                                </div>
                                <div id="message"></div>

                                <button class="btn btn-primary btn-lg btn-block" type="button" id="BtnSubmit">Add Set</button>

                                <br />

                            </form>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</section>

@section Scripts {
    <script src="~/js/croppie.js"></script>
    <script src="~/js/AddSet.js"></script>

    <script>
        // Example starter JavaScript for disabling form submissions if there are invalid fields
        (function () {
            'use strict';

            window.addEventListener('load', function () {
                // Fetch all the forms we want to apply custom Bootstrap validation styles to
                var forms = document.getElementsByClassName('needs-validation');

                // Loop over them and prevent submission
                var validation = Array.prototype.filter.call(forms, function (form) {
                    form.addEventListener('submit', function (event) {
                        if (form.checkValidity() === false) {
                            event.preventDefault();
                            event.stopPropagation();
                        }
                        form.classList.add('was-validated');
                    }, false);
                });
            }, false);
        })();
    </script>
}